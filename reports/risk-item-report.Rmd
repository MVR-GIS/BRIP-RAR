```{r, echo=FALSE, warning=FALSE, message=FALSE, results='asis'}
# Subset for the current risk item
risk_item <- risk %>%
  dplyr::filter(risk_no == x)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='asis'}
pander::pandoc.p(paste("## ", 
                 risk_item$risk_no_link, 
                 " {.unnumbered}"))
#pander::pandoc.header(risk_item$risk_no, level = 2)
pander::pandoc.p(risk_item$CONCERNS)
```


::::: {.grid-5w-2h}
::: {.var-name}
Start Date
:::
::: {.var-value}
`r risk_item$start_date`
:::
::: {.var-name}
End Date
:::
::: {.var-value}
`r risk_item$end_date`
:::
::: {.var-name}
Risk Category
:::
::: {.var-value}
`r risk_item$RISKCATEGORY`
:::
::: {.var-name}
Engagement Level
:::
::: {.var-value}
`r risk_item$ENG_LEVEL`
:::
::::: 


::::: {.grid-5w-2h}
::: {.var-name}
Risk Strategy
:::
::: {.var-value}
`r risk_item$RISK_STRATEGY`
:::
::: {.var-name}
Component
:::
::: {.var-value}
`r risk_item$COMPONENT`
:::
::: {.var-name}
Discipline
:::
::: {.var-value}
`r risk_item$DISCIPLINE`
:::
::: {.var-name}
Risk Opportunity Event
:::
::: {.var-value}
`r risk_item$RISK_OPPORTUNITY_EVENT`
:::
::: {.var-name}
Timing of Delay
:::
::: {.var-value}
`r risk_item$TIMING_OF_DELAY`
:::
:::::

```{r, echo=FALSE, warning=FALSE, message=FALSE}
cost_risk <- risk_item %>%
  select(COST_LIKELIHOOD, COST_IMPACT, COST_IMPACT_PER_PROJECT, 
         COST_RISK, cost_risk_color) %>%
  pivot_longer(cols = starts_with(c("COST", "cost")), 
               names_to = "cost_variable", 
               values_to = "cost") %>%
  mutate(variable = substring(cost_variable, 6, 23)) %>%
  mutate(variable = str_replace_all(variable, "_", " ")) %>%
  mutate(variable = str_to_lower(variable)) %>%
  mutate(variable = str_to_title(variable))

schedule_risk <- risk_item %>%
  select(SCHEDULE_LIKELIHOOD, SCHEDULE_IMPACT, SCHEDULE_IMPACT_PER_PROJECT, 
         SCHEDULE_RISK, schedule_risk_color) %>%
  pivot_longer(cols = starts_with(c("SCHEDULE", "schedule")), 
               names_to = "schedule_variable", 
               values_to = "schedule") %>%
  mutate(variable = substring(schedule_variable, 10, 27)) %>%
  mutate(variable = str_replace_all(variable, "_", " ")) %>%
  mutate(variable = str_to_lower(variable)) %>%
  mutate(variable = str_to_title(variable))

cost_schedule_risk <- cost_risk %>%
  select(variable, cost) %>%
  inner_join(select(schedule_risk, variable, schedule))
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
col_names <- c("", "Cost", "Schedule")

kbl(filter(cost_schedule_risk, variable != "Risk Color"),
    col.names = col_names) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", 
                                      "responsive"),
                full_width = FALSE, 
                position = "left") %>%
  row_spec(0, bold = TRUE) %>%
  column_spec(1, bold = TRUE, border_right = TRUE) %>%
  column_spec(2, color = "black",
              background = ifelse(cost_schedule_risk$cost == "Low", "green",
                                  ifelse(cost_schedule_risk$cost == "Moderate", "orange",
                                  ifelse(cost_schedule_risk$cost == "High", "red",
                                  "white")))) %>%
  column_spec(3, color = "black",
              background = ifelse(cost_schedule_risk$schedule == "Low", "green",
                                  ifelse(cost_schedule_risk$schedule == "Moderate", "orange",
                                  ifelse(cost_schedule_risk$schedule == "High", "red",
                                  "white"))))
```


::::: {.grid-5w-2h}
::: {.var-name}
POC
:::
::: {.var-value}
`r risk_item$RESPONSIBLE_POC`
:::
::: {.var-name}
Last Review Date
:::
::: {.var-value}
`r risk_item$POC_REVIEW_DATE`
:::
:::::



```{r, echo=FALSE, warning=FALSE, message=FALSE, results='asis'}
pander::pandoc.p('')
```
