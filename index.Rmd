--- 
title: "Brandon Road Interbasin Project Risk Analysis Report"
author: "USACE Rock Island District"
date: "`r Sys.Date()`"

site: bookdown::bookdown_site
documentclass: book
# url: report url 
# cover-image: images/cover.jpg
description: "Report description goes here."

bibliography: [book.bib, packages.bib]
biblio-style: apalike
csl: chicago-fullnote-bibliography.csl
---

# Introduction {-}

## Project 
* P2 project name: Brandon Rd-Great Lakes/Miss Rvr Interbasin
* P2 project number: 482782
* P2 program code: 451617


<!-- Libraries -->
```{r library, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(knitr)
library(rmarkdown)
library(lubridate)
library(tools)
library(kableExtra)
library(pander)
library(timevis)
```

<!-- Wrangle Data -->
```{r wrangle-risk, echo=FALSE, warning=FALSE, message=FALSE}
risk_oracle <- read_csv(file = "data/RR_Main_Report_View.csv")

# Set date fields
risk <- risk_oracle %>%
  mutate(start_date = lubridate::as_datetime(START_DATE)) %>%
  mutate(end_date   = lubridate::as_datetime(END_DATE)) %>%
  mutate(level_date = lubridate::as_datetime(LEVEL_DATE))

# Rename fields
risk <- risk %>%
  rename(cost_risk_color = CONDITIONAL_FORMATTING) %>%
  rename(schedule_risk_color = CONDITIONAL_FORMATTING2)

# Ensure colors are lowercase
risk$cost_risk_color     <- tolower(risk$cost_risk_color)
risk$schedule_risk_color <- tolower(risk$schedule_risk_color)

# Convert factor variables to title case
risk$RISKCATEGORY <- toTitleCase(tolower(risk$RISKCATEGORY))

# Remove unused fields
risk <- risk %>%
  select(!c(PDT_DISC_CONC, PDT_DISC_LIKELI_IMPACT, 
            PDT_DISC_RISK_MANAG_STRATEGY, ACTION_ITEMS, LESSONS_LEARNED, 
            START_DATE, END_DATE, LEVEL_DATE, FK_TABLE_ID))

# Create hyperlink to Risk_No
risk <- risk %>%
  mutate(risk_no = paste0("[", risk$RISK_NO, "](#", risk$RISK_NO, ")"))

# Reorder fields
risk <- risk %>%
  relocate(CONCERNS, .after = RISK_NO) %>%
  relocate(COST_RISK, .after = COST_IMPACT_PER_PROJECT) %>%
  relocate(cost_risk_color,  .after = COST_RISK) %>%
  relocate(SCHEDULE_RISK, .after = SCHEDULE_IMPACT_PER_PROJECT) %>%
  relocate(schedule_risk_color, .after = SCHEDULE_RISK) %>%
  relocate(TIMING_OF_DELAY, .after = RISK_STRATEGY) %>%
  relocate(start_date, .after = CONCERNS) %>%
  relocate(end_date, .after = start_date) %>%
  relocate(risk_no, .after = RISK_NO)

# Sort
risk <- risk %>%
  arrange(RISK_NO)
```

